{
    email {$ACME_EMAIL}
}

{$DOMAIN} {
    encode gzip zstd

    # Grafana UI (serve from subpath /grafana)
    handle /grafana* {
        reverse_proxy grafana:3000
    }

    # API reverse proxy (preserve /api prefix)
    handle /api* {
        reverse_proxy api:8080
    }

    # SPA static files
    handle {
        root * /usr/share/caddy
        try_files {path} /index.html
        file_server
    }
}


